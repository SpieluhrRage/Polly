# Система голосования за баланс игры

Курсовой проект: серверная часть системы голосования за баланс игры.  
Игроки проходят авторизацию и голосуют в опросах, посвящённых изменениям баланса (усиление/ослабление персонажей, предметов, механик).  
Сервер предоставляет REST-API для веб-клиента и потенциального внутриигрового клиента.

---

## Цели проекта

- Обеспечить **сбор и обработку голосов** игроков по вопросам баланса игры.
- Гарантировать **ограничение одного голоса на опрос** для каждого пользователя.
- Обеспечить **хранение результатов голосования** и получение агрегированных итогов.
- Продемонстрировать применение **многослойной архитектуры (упрощённая Clean Architecture)** в учебном проекте.

---

## Используемый стек

- **PHP 8** – реализация бизнес-логики и HTTP-слоя.
- **Apache HTTP Server** – обработка HTTP-запросов и запуск PHP-приложения.
- **MySQL** – реляционная СУБД для хранения пользователей, опросов, вариантов и голосов.
- **Docker + Docker Compose** – развёртывание и изоляция окружения (контейнер с PHP/Apache и контейнер с MySQL).
- **Composer** – управление зависимостями PHP.
- **PHPUnit** – модульное тестирование.
- **Visual Studio Code** – основная среда разработки.

---

## Архитектура

Проект организован по принципам упрощённой **Clean Architecture** с разделением на слои:

- **HTTP-слой** (`public/`, `src/Http/`):
  - роутер;
  - контроллеры авторизации, опросов и голосования.

- **Прикладной слой** (`src/Application/`):
  - сервисы: `AuthService`, `CreatePollService`, `CastVoteService`, `GetPollResultsService` и др.;
  - реализация сценариев: регистрация, логин, создание опросов по балансу, сбор голосов, получение результатов.

- **Доменный слой** (`src/Domain/`):
  - сущности: `User`, `Poll`, `Option`, `Vote`;
  - доменные правила (например, проверка возможности голосования, ограничения по одному голосу).

- **Инфраструктура** (`src/Infrastructure/`):
  - репозитории для работы с MySQL;
  - класс подключения к базе;
  - логирование попыток голосования.

---

## Основные возможности

- Регистрация и авторизация пользователей.
- Создание опросов по балансу игры (администратором).
- Добавление вариантов ответов к опросам.
- Голосование авторизованных пользователей.
- Ограничение: **один голос на пользователя в рамках одного опроса**.
- Получение текущих результатов голосования.

---

## Запуск через Docker

1. Установить **Docker** и **Docker Compose**.
2. Склонировать репозиторий:

```bash
git clone https://github.com/SpieluhrRage/Polly
cd <папка-проекта>
```

3. Поднять контейнеры:

```bash
docker-compose up --build
```

4. После успешного запуска приложение будет доступно по адресу, указанному в `docker-compose.yml`  
(например, `http://localhost:8080`).

5. Инициализация базы данных:

- либо автоматически при старте контейнера (если настроено),
- либо вручную, выполнив `database/schema.sql` в контейнере MySQL.

---

## Примеры REST-эндпоинтов

> Конкретные пути и параметры можно дополнить под фактическую реализацию.

- `POST /api/register` – регистрация пользователя  
- `POST /api/login` – авторизация, выдача токена / cookie  
- `GET  /api/polls` – список опросов по балансу  
- `POST /api/polls` – создание нового опроса (для администратора)  
- `POST /api/polls/{pollId}/vote` – голосование за вариант  
- `GET  /api/polls/{pollId}/results` – получение результатов голосования

Ответы возвращаются в формате **JSON**.

---

## Тестирование

Для запуска модульных тестов (PHPUnit):

```bash
# Локально (если установлены PHP и Composer)
composer install
composer test

# Либо внутри контейнера приложения
docker exec -it <имя-контейнера-с-php> vendor/bin/phpunit
```

---

## Учебный контекст

Проект выполнен в рамках курсовой работы по теме  
**«Серверная часть системы голосования за баланс игры»**.

Основные аспекты, демонстрируемые в работе:

- проектирование архитектуры по принципам Clean Architecture;
- реализация REST-API на PHP 8;
- использование Docker и MySQL в учебном проекте;
- обеспечение базовой защиты от накрутки голосов.

---

## Возможные направления развития

- Подключение реального внутриигрового клиента.
- Добавление роли администратора с веб-интерфейсом управления опросами.
- Расширение механизма защиты от накрутки (rate limiting, более детальное логирование).
- Визуализация статистики и графики по результатам голосований.
